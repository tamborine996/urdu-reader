<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Urdu Reading Practice</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Nastaliq+Urdu&family=Crimson+Pro:ital,wght@0,300;0,400;0,500;0,600;1,400&family=Cormorant+Garamond:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --ink-deep: #0a0a14;
            --ink-medium: #12121f;
            --ink-light: #1a1a2e;
            --ink-subtle: #252540;
            --gold-antique: #c9a962;
            --gold-bright: #e8c547;
            --gold-soft: rgba(201, 169, 98, 0.15);
            --gold-glow: rgba(201, 169, 98, 0.4);
            --parchment: #f4ede4;
            --parchment-dim: #d4cdc4;
            --cream: #faf8f5;
            --text-primary: #e8e4dc;
            --text-secondary: #a8a4a0;
            --text-muted: #706c68;
            --accent-azure: #5b8fb9;
            --accent-azure-glow: rgba(91, 143, 185, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Crimson Pro', Georgia, serif;
            background: var(--ink-deep);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.7;
            position: relative;
        }

        /* Subtle paper texture overlay */
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
            opacity: 0.03;
            pointer-events: none;
            z-index: 0;
        }

        /* Decorative gradient orbs */
        body::after {
            content: '';
            position: fixed;
            top: -200px;
            right: -200px;
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, var(--gold-soft) 0%, transparent 70%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 30px;
            position: relative;
            z-index: 1;
        }

        /* Header */
        header {
            text-align: center;
            margin-bottom: 50px;
            position: relative;
        }

        header::before,
        header::after {
            content: 'â—†';
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gold-antique);
            font-size: 0.6rem;
            opacity: 0.5;
        }

        header::before { left: 20%; }
        header::after { right: 20%; }

        h1 {
            font-family: 'Cormorant Garamond', serif;
            font-weight: 400;
            font-size: 2.2rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: var(--parchment);
            margin-bottom: 12px;
            position: relative;
            display: inline-block;
        }

        h1::before,
        h1::after {
            content: '';
            position: absolute;
            top: 50%;
            width: 60px;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--gold-antique), transparent);
        }

        h1::before { right: calc(100% + 20px); }
        h1::after { left: calc(100% + 20px); }

        .instructions {
            font-size: 0.95rem;
            color: var(--text-secondary);
            font-style: italic;
            letter-spacing: 0.02em;
        }

        .instructions span {
            color: var(--gold-antique);
        }

        /* Controls */
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }

        .article-selector {
            appearance: none;
            background: var(--ink-medium);
            border: 1px solid var(--ink-subtle);
            color: var(--parchment);
            padding: 14px 50px 14px 24px;
            border-radius: 4px;
            font-family: 'Crimson Pro', serif;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23c9a962' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 18px center;
            min-width: 320px;
        }

        .article-selector:hover,
        .article-selector:focus {
            border-color: var(--gold-antique);
            outline: none;
            box-shadow: 0 0 20px var(--gold-soft);
        }

        .saved-vocab-toggle {
            background: var(--ink-medium);
            border: 1px solid var(--ink-subtle);
            padding: 14px 28px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text-primary);
            font-family: 'Crimson Pro', serif;
            font-size: 1rem;
        }

        .saved-vocab-toggle::before {
            content: 'ğŸ“–';
            font-size: 1.1rem;
        }

        .saved-vocab-toggle:hover {
            border-color: var(--accent-azure);
            box-shadow: 0 0 20px var(--accent-azure-glow);
        }

        .bookmark-jump {
            background: var(--ink-medium);
            border: 1px solid var(--ink-subtle);
            padding: 14px 28px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text-primary);
            font-family: 'Crimson Pro', serif;
            font-size: 1rem;
        }

        .bookmark-jump::before {
            content: 'ğŸ”–';
            font-size: 1.1rem;
        }

        .bookmark-jump:hover {
            border-color: var(--gold-antique);
            box-shadow: 0 0 20px var(--gold-soft);
        }

        .bookmark-jump:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .bookmark-jump:disabled:hover {
            border-color: var(--ink-subtle);
            box-shadow: none;
        }

        .vocab-count {
            background: var(--accent-azure);
            color: var(--ink-deep);
            padding: 2px 10px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        /* Saved vocabulary panel */
        .saved-vocab-panel {
            display: none;
            background: linear-gradient(135deg, var(--ink-medium) 0%, var(--ink-light) 100%);
            border-radius: 8px;
            padding: 28px 32px;
            margin-bottom: 40px;
            border: 1px solid var(--ink-subtle);
            position: relative;
            overflow: hidden;
            animation: panelSlide 0.4s ease;
        }

        @keyframes panelSlide {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .saved-vocab-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--accent-azure), transparent);
        }

        .saved-vocab-panel.open {
            display: block;
        }

        .vocab-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .vocab-header h3 {
            font-family: 'Cormorant Garamond', serif;
            font-weight: 500;
            font-size: 1.3rem;
            color: var(--accent-azure);
            letter-spacing: 0.05em;
        }

        .clear-btn {
            background: transparent;
            border: 1px solid var(--text-muted);
            color: var(--text-muted);
            padding: 8px 18px;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Crimson Pro', serif;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .clear-btn:hover {
            border-color: #c75050;
            color: #c75050;
        }

        #vocab-list {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .vocab-item {
            background: var(--ink-deep);
            padding: 12px 18px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 14px;
            border: 1px solid var(--ink-subtle);
            animation: vocabFade 0.3s ease;
        }

        @keyframes vocabFade {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        .vocab-item .urdu-word {
            font-family: 'Noto Nastaliq Urdu', serif;
            color: var(--gold-antique);
            font-size: 1.2rem;
            direction: rtl;
        }

        .vocab-item .divider {
            width: 1px;
            height: 20px;
            background: var(--ink-subtle);
        }

        .vocab-item .english-word {
            color: var(--text-secondary);
            font-size: 0.95rem;
            font-style: italic;
        }

        .vocab-item .remove-btn {
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 4px 8px;
            font-size: 1.2rem;
            opacity: 0.5;
            transition: all 0.2s ease;
            margin-left: 4px;
        }

        .vocab-item .remove-btn:hover {
            opacity: 1;
            color: #c75050;
        }

        .empty-vocab {
            color: var(--text-muted);
            font-style: italic;
            padding: 20px 0;
        }

        /* Article content */
        #article-content {
            position: relative;
        }

        .paragraph-pair {
            display: grid;
            grid-template-columns: 1.1fr 1fr;
            gap: 0;
            margin-bottom: 2px;
            background: var(--ink-medium);
            border-radius: 0;
            position: relative;
            overflow: hidden;
            opacity: 0;
            animation: paragraphReveal 0.6s ease forwards;
        }

        .paragraph-pair:first-child {
            border-radius: 8px 8px 0 0;
        }

        .paragraph-pair:last-child {
            border-radius: 0 0 8px 8px;
        }

        @keyframes paragraphReveal {
            from {
                opacity: 0;
                transform: translateY(15px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .paragraph-pair:hover {
            background: var(--ink-light);
        }

        /* Bookmark button */
        .bookmark-btn {
            position: absolute;
            top: 12px;
            left: 12px;
            background: transparent;
            border: 1px solid transparent;
            color: var(--text-muted);
            cursor: pointer;
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 1rem;
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .paragraph-pair:hover .bookmark-btn {
            opacity: 0.6;
        }

        .bookmark-btn:hover {
            opacity: 1 !important;
            background: var(--ink-subtle);
            border-color: var(--gold-antique);
            color: var(--gold-antique);
        }

        .paragraph-pair.bookmarked .bookmark-btn {
            opacity: 1;
            color: var(--gold-bright);
        }

        .paragraph-pair.bookmarked {
            box-shadow: inset 4px 0 0 var(--gold-antique);
        }

        .paragraph-pair.bookmarked .urdu {
            background: linear-gradient(135deg, rgba(201, 169, 98, 0.12) 0%, transparent 100%);
        }

        .headline .bookmark-btn {
            display: none;
        }

        .paragraph-pair > div {
            padding: 28px 32px;
            transition: background 0.3s ease;
        }

        /* Urdu side - right aligned, given prominence */
        .urdu {
            font-family: 'Noto Nastaliq Urdu', 'Jameel Noori Nastaleeq', serif;
            font-size: 1.5rem;
            line-height: 2.4;
            direction: rtl;
            text-align: right;
            color: var(--parchment);
            background: linear-gradient(135deg, rgba(201, 169, 98, 0.05) 0%, transparent 100%);
            border-right: 3px solid var(--gold-antique);
            position: relative;
        }

        /* Ornamental corner */
        .urdu::before {
            content: '';
            position: absolute;
            top: 12px;
            right: 12px;
            width: 20px;
            height: 20px;
            border-top: 1px solid var(--gold-antique);
            border-right: 1px solid var(--gold-antique);
            opacity: 0.3;
        }

        /* English side */
        .english {
            font-size: 1.1rem;
            line-height: 1.9;
            color: var(--text-secondary);
            position: relative;
        }

        .english::after {
            content: '';
            position: absolute;
            bottom: 12px;
            left: 12px;
            width: 20px;
            height: 20px;
            border-bottom: 1px solid var(--ink-subtle);
            border-left: 1px solid var(--ink-subtle);
            opacity: 0.5;
        }

        /* Labels */
        .label {
            font-family: 'Cormorant Garamond', serif;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            color: var(--gold-antique);
            margin-bottom: 12px;
            display: block;
            opacity: 0.7;
        }

        .english .label {
            color: var(--text-muted);
        }

        /* Headline styling */
        .headline {
            background: linear-gradient(135deg, var(--ink-light) 0%, var(--ink-medium) 100%);
            margin-bottom: 20px;
            border-radius: 8px !important;
            border: 1px solid var(--ink-subtle);
        }

        .headline .urdu {
            font-size: 1.9rem;
            font-weight: normal;
            border-right-width: 4px;
            background: linear-gradient(135deg, rgba(201, 169, 98, 0.08) 0%, transparent 100%);
        }

        .headline .english {
            font-size: 1.35rem;
            font-weight: 500;
            color: var(--parchment-dim);
        }

        /* Clickable words - visual indicator for translatable words */
        .word {
            cursor: pointer;
            border-radius: 3px;
            padding: 0 4px;
            margin: 0 -2px;
            transition: all 0.25s ease;
            position: relative;
            border-bottom: 1px dotted var(--gold-antique);
            opacity: 0.95;
        }

        .urdu .word {
            border-bottom-width: 2px;
            padding-bottom: 2px;
        }

        .word:hover {
            background: var(--gold-soft);
            color: var(--gold-bright);
        }

        .word.highlighted {
            background: var(--gold-antique);
            color: var(--ink-deep);
            font-weight: 600;
            box-shadow: 0 0 20px var(--gold-glow), 0 2px 8px rgba(0, 0, 0, 0.3);
            text-shadow: none;
        }

        .urdu .word.highlighted {
            padding: 4px 10px;
            border-radius: 4px;
        }

        .english .word.highlighted {
            padding: 2px 6px;
        }

        /* Save flash animation */
        .word.saved-flash {
            animation: saveFlash 0.4s ease;
        }

        @keyframes saveFlash {
            0%, 100% { box-shadow: 0 0 0 var(--accent-azure-glow); }
            50% { box-shadow: 0 0 30px var(--accent-azure); }
        }

        /* Responsive */
        @media (max-width: 900px) {
            .container {
                padding: 25px 18px;
            }

            h1 {
                font-size: 1.6rem;
                letter-spacing: 0.1em;
            }

            h1::before, h1::after {
                display: none;
            }

            header::before, header::after {
                display: none;
            }

            .paragraph-pair {
                grid-template-columns: 1fr;
            }

            .urdu {
                border-right: none;
                border-bottom: 2px solid var(--gold-antique);
                padding-bottom: 24px;
            }

            .urdu::before {
                display: none;
            }

            .english::after {
                display: none;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .article-selector {
                min-width: unset;
            }

            .headline .urdu {
                font-size: 1.5rem;
            }

            .headline .english {
                font-size: 1.15rem;
            }
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--ink-deep);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--ink-subtle);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--gold-antique);
        }

        /* Footer ornament */
        .footer-ornament {
            text-align: center;
            margin-top: 50px;
            color: var(--gold-antique);
            font-size: 1.2rem;
            opacity: 0.4;
            letter-spacing: 0.5em;
        }

        /* Mobile responsive - stack vertically */
        @media (max-width: 768px) {
            .container {
                padding: 20px 15px;
            }

            h1 {
                font-size: 1.6rem;
                letter-spacing: 0.1em;
            }

            h1::before, h1::after {
                width: 30px;
            }

            header::before, header::after {
                display: none;
            }

            .instructions {
                font-size: 0.85rem;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
            }

            .article-selector {
                min-width: auto;
                width: 100%;
            }

            .saved-vocab-toggle,
            .bookmark-jump {
                justify-content: center;
            }

            /* Stack paragraphs vertically */
            .paragraph-pair {
                grid-template-columns: 1fr;
            }

            .paragraph-pair > div {
                padding: 20px;
            }

            /* Urdu on top with bottom border instead of right */
            .urdu {
                font-size: 1.3rem;
                line-height: 2.2;
                border-right: none;
                border-bottom: 2px solid var(--gold-antique);
            }

            .urdu::before {
                top: 8px;
                right: 8px;
                width: 15px;
                height: 15px;
            }

            /* English below */
            .english {
                font-size: 1rem;
                line-height: 1.7;
            }

            .english::after {
                bottom: 8px;
                left: 8px;
                width: 15px;
                height: 15px;
            }

            /* Bookmark button always visible on mobile (no hover) */
            .bookmark-btn {
                opacity: 0.5;
                top: 8px;
                left: 8px;
                padding: 4px 8px;
                font-size: 0.9rem;
            }

            .paragraph-pair.bookmarked .bookmark-btn {
                opacity: 1;
            }

            /* Bookmarked state - top border on mobile */
            .paragraph-pair.bookmarked {
                box-shadow: inset 0 4px 0 var(--gold-antique);
            }

            /* Vocab panel adjustments */
            .saved-vocab-panel {
                padding: 20px;
            }

            .vocab-item {
                padding: 10px 14px;
                gap: 10px;
            }

            .vocab-item .urdu-word {
                font-size: 1.1rem;
            }
        }

        /* Extra small screens */
        @media (max-width: 400px) {
            .urdu {
                font-size: 1.15rem;
            }

            .english {
                font-size: 0.95rem;
            }

            .paragraph-pair > div {
                padding: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Urdu Reader</h1>
            <p class="instructions">Click a word to see its translation <span>â€¢</span> Double-click to save <span>â€¢</span> ğŸ”– to bookmark</p>
        </header>

        <div class="controls">
            <select class="article-selector" id="article-selector" onchange="loadArticle(this.value)">
                <option value="myanmar">Ù…ÛŒØ§Ù†Ù…Ø§Ø± Ø§Ù„ÛŒÚ©Ø´Ù† â€” Myanmar Elections</option>
                <option value="school">Ø³Ú©ÙˆÙ„ Ù…ÛŒÚº Ø³Ø²Ø§ â€” School Punishment</option>
                <option value="brothers">Ø¨Ú¾Ø§Ø¦ÛŒÙˆÚº Ú©ÛŒ Ù…Ù„Ø§Ù‚Ø§Øª â€” Brothers Reunited</option>
                <option value="lion-mouse">Ø´ÛŒØ± Ø§ÙˆØ± Ú†ÙˆÛØ§ â€” The Lion and the Mouse</option>
                <option value="chura-sharif">Ú†ÙˆØ±Ø§ Ø´Ø±ÛŒÙ Ø§Ù†Ù¹Ø±ÙˆÛŒÙˆ â€” Chura Sharif Interview</option>
            </select>

            <div class="saved-vocab-toggle" onclick="toggleVocabPanel()">
                <span>Saved Words</span>
                <span class="vocab-count" id="vocab-count">0</span>
            </div>

            <button class="bookmark-jump" id="bookmark-jump" onclick="jumpToBookmark()" disabled>
                <span>Jump to Bookmark</span>
            </button>
        </div>

        <div class="saved-vocab-panel" id="vocab-panel">
            <div class="vocab-header">
                <h3>Saved Vocabulary</h3>
                <button onclick="clearAllVocab()" class="clear-btn">Clear All</button>
            </div>
            <div id="vocab-list"></div>
        </div>

        <div id="article-content"></div>

        <div class="footer-ornament">â—† â—‡ â—†</div>
    </div>

    <script>
        const STORAGE_KEY = 'urdu-reader-vocab';
        const BOOKMARK_KEY = 'urdu-reader-bookmarks';
        let currentArticleId = 'myanmar';

        // Article cache - loaded from JSON files
        const articlesCache = {};

        // Fetch article from JSON file
        async function fetchArticle(articleId) {
            if (articlesCache[articleId]) {
                return articlesCache[articleId];
            }

            try {
                const response = await fetch(`articles/${articleId}.json`);
                if (!response.ok) throw new Error(`Failed to load article: ${articleId}`);
                const article = await response.json();
                articlesCache[articleId] = article;
                return article;
            } catch (error) {
                console.error('Error loading article:', error);
                return null;
            }
        }

        // Wrap vocabulary words with spans for highlighting
        function wrapVocabulary(text, vocabulary, isUrdu = false) {
            if (!vocabulary || Object.keys(vocabulary).length === 0) return text;

            // Sort vocabulary by length (longest first) to match longer phrases before shorter ones
            const sortedWords = Object.keys(vocabulary).sort((a, b) => b.length - a.length);

            let result = text;
            for (const urduWord of sortedWords) {
                const englishWord = vocabulary[urduWord];
                // Create a regex that matches the word (case-insensitive for English)
                // Use word boundaries for English, but not for Urdu (Urdu doesn't have word boundaries in the same way)
                const escapedWord = urduWord.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                const regex = isUrdu
                    ? new RegExp(escapedWord, 'g')
                    : new RegExp(`\\b${escapedWord}\\b`, 'gi');

                // Replace with span-wrapped version, using the English translation as the data-word key
                result = result.replace(regex, (match) => {
                    // Normalize the key - use lowercase hyphenated for multi-word phrases
                    const key = englishWord.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '');
                    return `<span class="word" data-word="${key}">${match}</span>`;
                });
            }

            return result;
        }

        // Available article IDs - loaded dynamically from JSON files
        const availableArticles = ['myanmar', 'school', 'brothers', 'lion-mouse', 'chura-sharif'];

        // Placeholder for legacy compatibility (loadArticle now uses fetchArticle)
        const articles = {
            _placeholder: {
                title: { urdu: "Ù„ÙˆÚˆ ÛÙˆ Ø±ÛØ§ ÛÛ’...", english: "Loading..." },
                paragraphs: []
            }
        };

        // END OF INLINE DATA - All articles now loaded from JSON files

        // Render article with staggered animations - now async to fetch from JSON
        async function loadArticle(articleId) {
            // Fetch article from JSON file
            const article = await fetchArticle(articleId);
            if (!article) {
                console.error(`Article not found: ${articleId}`);
                return;
            }

            currentArticleId = articleId;
            const container = document.getElementById('article-content');
            const bookmarkedIndex = getBookmark(articleId);

            // Build HTML - wrap vocabulary words dynamically from JSON vocabulary mapping
            const vocab = article.vocabulary || {};

            // Build English vocabulary (English word -> English word, so key generation matches Urdu side)
            const englishVocab = {};
            for (const [urduWord, englishWord] of Object.entries(vocab)) {
                englishVocab[englishWord] = englishWord;
            }

            let html = `
                <div class="paragraph-pair headline" style="animation-delay: 0ms">
                    <div class="urdu">
                        <span class="label">Ø§Ø±Ø¯Ùˆ</span>
                        ${wrapVocabulary(article.title.urdu, vocab, true)}
                    </div>
                    <div class="english">
                        <span class="label">English</span>
                        ${wrapVocabulary(article.title.english, englishVocab, false)}
                    </div>
                </div>
            `;

            article.paragraphs.forEach((para, index) => {
                const delay = (index + 1) * 60; // Staggered animation
                const isBookmarked = index === bookmarkedIndex;
                html += `
                    <div class="paragraph-pair${isBookmarked ? ' bookmarked' : ''}" data-para-index="${index}" style="animation-delay: ${delay}ms">
                        <button class="bookmark-btn" onclick="toggleBookmark(${index})" title="Bookmark this paragraph">ğŸ”–</button>
                        <div class="urdu">${wrapVocabulary(para.urdu, vocab, true)}</div>
                        <div class="english">${wrapVocabulary(para.english, englishVocab, false)}</div>
                    </div>
                `;
            });

            container.innerHTML = html;

            // Reattach event listeners
            attachWordListeners();
            updateBookmarkButton();

            // Auto-scroll to bookmark after animations settle
            if (bookmarkedIndex !== null) {
                setTimeout(() => {
                    jumpToBookmark();
                }, 500);
            }
        }

        // Attach click/dblclick listeners to words
        function attachWordListeners() {
            document.querySelectorAll('.word').forEach(word => {
                word.addEventListener('click', function(e) {
                    const wordKey = this.dataset.word;
                    const paragraphPair = this.closest('.paragraph-pair');

                    document.querySelectorAll('.word.highlighted').forEach(el => {
                        el.classList.remove('highlighted');
                    });

                    paragraphPair.querySelectorAll(`.word[data-word="${wordKey}"]`).forEach(el => {
                        el.classList.add('highlighted');
                    });
                });

                word.addEventListener('dblclick', function(e) {
                    e.preventDefault();
                    const wordKey = this.dataset.word;
                    const paragraphPair = this.closest('.paragraph-pair');
                    addToVocab(wordKey, paragraphPair);

                    // Visual feedback
                    this.classList.add('saved-flash');
                    setTimeout(() => this.classList.remove('saved-flash'), 400);
                });
            });
        }

        // Vocabulary functions
        function getSavedVocab() {
            const stored = localStorage.getItem(STORAGE_KEY);
            return stored ? JSON.parse(stored) : [];
        }

        function saveVocab(vocab) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(vocab));
            updateVocabCount();
            renderVocabList();
        }

        function updateVocabCount() {
            document.getElementById('vocab-count').textContent = getSavedVocab().length;
        }

        function toggleVocabPanel() {
            document.getElementById('vocab-panel').classList.toggle('open');
        }

        function renderVocabList() {
            const list = document.getElementById('vocab-list');
            const vocab = getSavedVocab();

            if (vocab.length === 0) {
                list.innerHTML = '<p class="empty-vocab">No saved words yet. Double-click any highlighted word to save it.</p>';
                return;
            }

            list.innerHTML = vocab.map((item, index) => `
                <div class="vocab-item">
                    <span class="urdu-word">${item.urdu}</span>
                    <span class="divider"></span>
                    <span class="english-word">${item.english}</span>
                    <button class="remove-btn" onclick="removeVocab(${index})">Ã—</button>
                </div>
            `).join('');
        }

        function removeVocab(index) {
            const vocab = getSavedVocab();
            vocab.splice(index, 1);
            saveVocab(vocab);
        }

        function clearAllVocab() {
            if (confirm('Clear all saved vocabulary?')) {
                saveVocab([]);
            }
        }

        function addToVocab(wordKey, paragraphPair) {
            const vocab = getSavedVocab();

            if (vocab.some(item => item.key === wordKey)) {
                return;
            }

            const urduWord = paragraphPair.querySelector(`.urdu .word[data-word="${wordKey}"]`);
            const englishWord = paragraphPair.querySelector(`.english .word[data-word="${wordKey}"]`);

            if (urduWord && englishWord) {
                vocab.push({
                    key: wordKey,
                    urdu: urduWord.textContent,
                    english: englishWord.textContent
                });
                saveVocab(vocab);
            }
        }

        // Clear highlights when clicking elsewhere
        document.addEventListener('click', function(e) {
            if (!e.target.classList.contains('word')) {
                document.querySelectorAll('.word.highlighted').forEach(el => {
                    el.classList.remove('highlighted');
                });
            }
        });

        // Bookmark functions
        function getBookmarks() {
            const stored = localStorage.getItem(BOOKMARK_KEY);
            return stored ? JSON.parse(stored) : {};
        }

        function getBookmark(articleId) {
            const bookmarks = getBookmarks();
            return bookmarks[articleId] !== undefined ? bookmarks[articleId] : null;
        }

        function setBookmark(articleId, paragraphIndex) {
            const bookmarks = getBookmarks();
            if (paragraphIndex === null) {
                delete bookmarks[articleId];
            } else {
                bookmarks[articleId] = paragraphIndex;
            }
            localStorage.setItem(BOOKMARK_KEY, JSON.stringify(bookmarks));
            updateBookmarkButton();
        }

        function toggleBookmark(paragraphIndex) {
            const currentBookmark = getBookmark(currentArticleId);

            // Remove existing bookmark styling
            document.querySelectorAll('.paragraph-pair.bookmarked').forEach(el => {
                el.classList.remove('bookmarked');
            });

            if (currentBookmark === paragraphIndex) {
                // Clicking same paragraph - remove bookmark
                setBookmark(currentArticleId, null);
            } else {
                // Set new bookmark
                setBookmark(currentArticleId, paragraphIndex);
                const para = document.querySelector(`.paragraph-pair[data-para-index="${paragraphIndex}"]`);
                if (para) {
                    para.classList.add('bookmarked');
                }
            }
        }

        function jumpToBookmark() {
            const bookmarkedIndex = getBookmark(currentArticleId);
            if (bookmarkedIndex === null) return;

            const para = document.querySelector(`.paragraph-pair[data-para-index="${bookmarkedIndex}"]`);
            if (para) {
                para.scrollIntoView({ behavior: 'smooth', block: 'center' });
                // Flash effect
                para.style.transition = 'box-shadow 0.3s ease';
                para.style.boxShadow = 'inset 4px 0 0 var(--gold-antique), 0 0 30px var(--gold-glow)';
                setTimeout(() => {
                    para.style.boxShadow = 'inset 4px 0 0 var(--gold-antique)';
                }, 800);
            }
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmark-jump');
            const hasBookmark = getBookmark(currentArticleId) !== null;
            btn.disabled = !hasBookmark;
        }

        // Initialize
        updateVocabCount();
        renderVocabList();
        loadArticle('myanmar');
    </script>
</body>
</html>
